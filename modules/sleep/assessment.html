<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title-ar">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙˆÙ… - ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„ØµØ­ÙŠØ©</title>
    <title id="title-en" style="display:none;">Sleep Assessment - Healthy Life App</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../theme.css">
    <link rel="stylesheet" href="sleep-styles.css">
    <link rel="stylesheet" href="sleep-assessment.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <button onclick="window.history.back()" id="backBtn">
        <span id="back-ar" style="display:block;"><i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹</span>
        <span id="back-en" style="display:none;"><i class="fas fa-arrow-left"></i> Back</span>
    </button>
    
    <div class="container assessment-container">
        <div id="lang-switch">
            <button class="lang-btn" id="lang-ar" style="font-weight:bold;">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
            <button class="lang-btn" id="lang-en">English</button>
        </div>
        
        <h1 id="page-title-ar" style="display:block;">ğŸ“‹ ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†ÙˆÙ…</h1>
        <h1 id="page-title-en" style="display:none;">ğŸ“‹ Sleep Quality Assessment</h1>
        
        <div class="summary">
            <p id="intro-ar" style="display:block;">
                <strong>Ø§ÙƒØªØ´Ù Ø¬ÙˆØ¯Ø© Ù†ÙˆÙ…Ùƒ!</strong><br>
                Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ Ù„Ø¬ÙˆØ¯Ø© Ù†ÙˆÙ…Ùƒ ÙˆØªÙˆØµÙŠØ§Øª Ù…Ø®ØµØµØ©.
            </p>
            <p id="intro-en" style="display:none;">
                <strong>Discover your sleep quality!</strong><br>
                Answer the following questions to get a comprehensive assessment of your sleep quality and personalized recommendations.
            </p>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
        <div class="assessment-progress">
            <div class="assessment-progress-fill" id="progress-bar" style="width: 0%;"></div>
        </div>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            <span id="progress-text-ar" style="display:block;">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 15</span>
            <span id="progress-text-en" style="display:none;">Question 1 of 15</span>
        </p>

        <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
        <form id="sleep-assessment-form">
            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
            <div class="question-section" id="section-1">
                <h3 id="section1-title-ar" style="display:block;">ğŸ• Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù†ÙˆÙ…</h3>
                <h3 id="section1-title-en" style="display:none;">ğŸ• Basic Sleep Habits</h3>
                
                <div class="question-item">
                    <label id="q1-ar" style="display:block;">ÙƒÙ… Ø³Ø§Ø¹Ø© ØªÙ†Ø§Ù… Ø¹Ø§Ø¯Ø© ÙÙŠ Ø§Ù„Ù„ÙŠÙ„Ø©ØŸ</label>
                    <label id="q1-en" style="display:none;">How many hours do you usually sleep per night?</label>
                    <select name="sleep_hours" required>
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="4">Ø£Ù‚Ù„ Ù…Ù† 5 Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="5">5-6 Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="7">7-8 Ø³Ø§Ø¹Ø§Øª</option>
                        <option value="9">9+ Ø³Ø§Ø¹Ø§Øª</option>
                    </select>
                </div>

                <div class="question-item">
                    <label id="q2-ar" style="display:block;">ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª ØªØ°Ù‡Ø¨ Ù„Ù„Ù†ÙˆÙ… Ø¹Ø§Ø¯Ø©ØŸ</label>
                    <label id="q2-en" style="display:none;">What time do you usually go to bed?</label>
                    <input type="time" name="bedtime" required>
                </div>

                <div class="question-item">
                    <label id="q3-ar" style="display:block;">ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª ØªØ³ØªÙŠÙ‚Ø¸ Ø¹Ø§Ø¯Ø©ØŸ</label>
                    <label id="q3-en" style="display:none;">What time do you usually wake up?</label>
                    <input type="time" name="wakeup" required>
                </div>

                <div class="question-item">
                    <label id="q4-ar" style="display:block;">Ù‡Ù„ ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù†ÙˆÙ… ÙÙŠ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ</label>
                    <label id="q4-en" style="display:none;">Do you maintain the same sleep schedule on weekends?</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="weekend_schedule" value="yes" id="weekend_yes">
                            <label for="weekend_yes" id="yes-ar" style="display:block;">Ù†Ø¹Ù…ØŒ Ø¯Ø§Ø¦Ù…Ø§Ù‹</label>
                            <label for="weekend_yes" id="yes-en" style="display:none;">Yes, always</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="weekend_schedule" value="sometimes" id="weekend_sometimes">
                            <label for="weekend_sometimes" id="sometimes-ar" style="display:block;">Ø£Ø­ÙŠØ§Ù†Ø§Ù‹</label>
                            <label for="weekend_sometimes" id="sometimes-en" style="display:none;">Sometimes</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="weekend_schedule" value="no" id="weekend_no">
                            <label for="weekend_no" id="no-ar" style="display:block;">Ù„Ø§ØŒ Ø£Ø¨Ø¯Ø§Ù‹</label>
                            <label for="weekend_no" id="no-en" style="display:none;">No, never</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†ÙˆÙ… -->
            <div class="question-section" id="section-2" style="display:none;">
                <h3 id="section2-title-ar" style="display:block;">â­ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†ÙˆÙ…</h3>
                <h3 id="section2-title-en" style="display:none;">â­ Sleep Quality</h3>
                
                <div class="question-item">
                    <label id="q5-ar" style="display:block;">ÙƒÙ… Ù…Ù† Ø§Ù„ÙˆÙ‚Øª ØªØ­ØªØ§Ø¬ Ø¹Ø§Ø¯Ø© Ù„Ù„Ù†ÙˆÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„ÙØ±Ø§Ø´ØŸ</label>
                    <label id="q5-en" style="display:none;">How long does it usually take you to fall asleep?</label>
                    <select name="sleep_latency" required>
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="5">Ø£Ù‚Ù„ Ù…Ù† 15 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="15">15-30 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="45">30-60 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="60">Ø£ÙƒØ«Ø± Ù…Ù† Ø³Ø§Ø¹Ø©</option>
                    </select>
                </div>

                <div class="question-item">
                    <label id="q6-ar" style="display:block;">ÙƒÙ… Ù…Ø±Ø© ØªØ³ØªÙŠÙ‚Ø¸ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„ÙŠÙ„ØŸ</label>
                    <label id="q6-en" style="display:none;">How many times do you wake up during the night?</label>
                    <select name="night_awakenings" required>
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="0">Ù„Ø§ Ø£Ø³ØªÙŠÙ‚Ø¸</option>
                        <option value="1">1-2 Ù…Ø±Ø§Øª</option>
                        <option value="3">3-4 Ù…Ø±Ø§Øª</option>
                        <option value="5">Ø£ÙƒØ«Ø± Ù…Ù† 4 Ù…Ø±Ø§Øª</option>
                    </select>
                </div>

                <div class="question-item">
                    <label id="q7-ar" style="display:block;">ÙƒÙŠÙ ØªØ´Ø¹Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸ ØµØ¨Ø§Ø­Ø§Ù‹ØŸ</label>
                    <label id="q7-en" style="display:none;">How do you feel when you wake up in the morning?</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="morning_feeling" value="refreshed" id="refreshed">
                            <label for="refreshed" id="refreshed-ar" style="display:block;">Ù…Ù†ØªØ¹Ø´ ÙˆÙ†Ø´ÙŠØ·</label>
                            <label for="refreshed" id="refreshed-en" style="display:none;">Refreshed and energetic</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="morning_feeling" value="okay" id="okay">
                            <label for="okay" id="okay-ar" style="display:block;">Ø¹Ø§Ø¯ÙŠ</label>
                            <label for="okay" id="okay-en" style="display:none;">Okay</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="morning_feeling" value="tired" id="tired">
                            <label for="tired" id="tired-ar" style="display:block;">Ù…ØªØ¹Ø¨ ÙˆÙ…Ø±Ù‡Ù‚</label>
                            <label for="tired" id="tired-en" style="display:none;">Tired and exhausted</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© -->
            <div class="question-section" id="section-3" style="display:none;">
                <h3 id="section3-title-ar" style="display:block;">ğŸŒ™ Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆÙ…</h3>
                <h3 id="section3-title-en" style="display:none;">ğŸŒ™ Factors Affecting Sleep</h3>
                
                <div class="question-item">
                    <label id="q8-ar" style="display:block;">Ù‡Ù„ ØªØªÙ†Ø§ÙˆÙ„ Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ†ØŸ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù†Ø¹Ù…ØŒ Ù…ØªÙ‰ Ø¢Ø®Ø± Ù…Ø±Ø© ØªØªÙ†Ø§ÙˆÙ„Ù‡ØŸ</label>
                    <label id="q8-en" style="display:none;">Do you consume caffeine? If yes, when is your last intake?</label>
                    <select name="caffeine" required>
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="none">Ù„Ø§ Ø£ØªÙ†Ø§ÙˆÙ„ Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ†</option>
                        <option value="morning">ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ ÙÙ‚Ø·</option>
                        <option value="afternoon">Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±</option>
                        <option value="evening">ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¡</option>
                        <option value="night">Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ù…Ø¨Ø§Ø´Ø±Ø©</option>
                    </select>
                </div>

                <div class="question-item">
                    <label id="q9-ar" style="display:block;">Ù‡Ù„ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø´Ø§Ø´Ø§Øª (Ù‡Ø§ØªÙØŒ ØªÙ„ÙØ§Ø²ØŒ ÙƒÙ…Ø¨ÙŠÙˆØªØ±) Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…ØŸ</label>
                    <label id="q9-en" style="display:none;">Do you use screens (phone, TV, computer) before bed?</label>
                    <select name="screen_time" required>
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="none">Ù„Ø§ Ø£Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…</option>
                        <option value="1hour">Ø£ØªÙˆÙ‚Ù Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø¨Ø³Ø§Ø¹Ø©</option>
                        <option value="30min">Ø£ØªÙˆÙ‚Ù Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø¨Ù€30 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="immediately">Ø£Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø­ØªÙ‰ ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…</option>
                    </select>
                </div>

                <div class="question-item">
                    <label id="q10-ar" style="display:block;">ÙƒÙŠÙ ØªØµÙ Ø¨ÙŠØ¦Ø© Ù†ÙˆÙ…ÙƒØŸ</label>
                    <label id="q10-en" style="display:none;">How would you describe your sleep environment?</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="sleep_environment" value="ideal" id="ideal">
                            <label for="ideal" id="ideal-ar" style="display:block;">Ù…Ø«Ø§Ù„ÙŠØ© (Ù…Ø¸Ù„Ù…Ø©ØŒ Ù‡Ø§Ø¯Ø¦Ø©ØŒ Ø¨Ø§Ø±Ø¯Ø©)</label>
                            <label for="ideal" id="ideal-en" style="display:none;">Ideal (dark, quiet, cool)</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="sleep_environment" value="good" id="good">
                            <label for="good" id="good-ar" style="display:block;">Ø¬ÙŠØ¯Ø©</label>
                            <label for="good" id="good-en" style="display:none;">Good</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="sleep_environment" value="poor" id="poor">
                            <label for="poor" id="poor-ar" style="display:block;">Ø³ÙŠØ¦Ø© (Ù…Ø¶ÙŠØ¦Ø©ØŒ ØµØ§Ø®Ø¨Ø©ØŒ Ø­Ø§Ø±Ø©)</label>
                            <label for="poor" id="poor-en" style="display:none;">Poor (bright, noisy, hot)</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
            <div class="navigation-buttons">
                <button type="button" class="nav-btn secondary" id="prev-btn" onclick="previousSection()" disabled>
                    <span id="prev-ar" style="display:block;">Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
                    <span id="prev-en" style="display:none;">Previous</span>
                </button>
                <button type="button" class="nav-btn" id="next-btn" onclick="nextSection()">
                    <span id="next-ar" style="display:block;">Ø§Ù„ØªØ§Ù„ÙŠ</span>
                    <span id="next-en" style="display:none;">Next</span>
                </button>
                <button type="submit" class="nav-btn" id="submit-btn" style="display:none;">
                    <span id="submit-ar" style="display:block;">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</span>
                    <span id="submit-en" style="display:none;">Get Results</span>
                </button>
            </div>
        </form>

        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
        <div id="results-container" style="display:none;">
            <div class="card">
                <h2 id="results-title-ar" style="display:block;">ğŸ¯ Ù†ØªØ§Ø¦Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙˆÙ…</h2>
                <h2 id="results-title-en" style="display:none;">ğŸ¯ Sleep Assessment Results</h2>
                
                <div id="score-display">
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 3em; font-weight: bold; color: #4CAF50;" id="score-value">85</div>
                        <div id="score-label-ar" style="display:block;">Ù†Ù‚Ø·Ø© Ù…Ù† 100</div>
                        <div id="score-label-en" style="display:none;">out of 100 points</div>
                    </div>
                </div>
                
                <div id="recommendations">
                    <h3 id="rec-title-ar" style="display:block;">ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø®ØµØµØ©</h3>
                    <h3 id="rec-title-en" style="display:none;">ğŸ’¡ Personalized Recommendations</h3>
                    <ul id="recommendations-list"></ul>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="saveToHealthState()">
                        <span id="save-ar" style="display:block;">Ø­ÙØ¸ ÙÙŠ Ø­Ø§Ù„ØªÙŠ Ø§Ù„ØµØ­ÙŠØ©</span>
                        <span id="save-en" style="display:none;">Save to Health State</span>
                    </button>
                    <button class="btn" onclick="retakeAssessment()" style="background: #f5f5f5; color: #666; margin-right: 10px;">
                        <span id="retake-ar" style="display:block;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
                        <span id="retake-en" style="display:none;">Retake Assessment</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="sleep-utils.js"></script>
    <script>
        let currentSection = 1;
        const totalSections = 3;
        const totalQuestions = 10;
        
        function updateProgress() {
            const progress = ((currentSection - 1) / totalSections) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            
            const questionNumber = (currentSection - 1) * Math.ceil(totalQuestions / totalSections) + 1;
            document.getElementById('progress-text-ar').textContent = `Ø§Ù„Ù‚Ø³Ù… ${currentSection} Ù…Ù† ${totalSections}`;
            document.getElementById('progress-text-en').textContent = `Section ${currentSection} of ${totalSections}`;
        }
        
        function nextSection() {
            if (validateCurrentSection()) {
                document.getElementById(`section-${currentSection}`).style.display = 'none';
                currentSection++;
                
                if (currentSection <= totalSections) {
                    document.getElementById(`section-${currentSection}`).style.display = 'block';
                    updateProgress();
                    
                    document.getElementById('prev-btn').disabled = false;
                    
                    if (currentSection === totalSections) {
                        document.getElementById('next-btn').style.display = 'none';
                        document.getElementById('submit-btn').style.display = 'inline-block';
                    }
                }
            }
        }
        
        function previousSection() {
            if (currentSection > 1) {
                document.getElementById(`section-${currentSection}`).style.display = 'none';
                currentSection--;
                document.getElementById(`section-${currentSection}`).style.display = 'block';
                updateProgress();
                
                document.getElementById('next-btn').style.display = 'inline-block';
                document.getElementById('submit-btn').style.display = 'none';
                
                if (currentSection === 1) {
                    document.getElementById('prev-btn').disabled = true;
                }
            }
        }
        
        function validateCurrentSection() {
            const section = document.getElementById(`section-${currentSection}`);
            const requiredFields = section.querySelectorAll('[required]');
            const radioGroups = section.querySelectorAll('input[type="radio"]');
            
            for (let field of requiredFields) {
                if (!field.value) {
                    alert(lang === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' : 'Please fill all required fields');
                    return false;
                }
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ
            const radioGroupNames = [...new Set([...radioGroups].map(r => r.name))];
            for (let groupName of radioGroupNames) {
                const groupRadios = section.querySelectorAll(`input[name="${groupName}"]`);
                if (groupRadios.length > 0 && ![...groupRadios].some(r => r.checked)) {
                    alert(lang === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©' : 'Please select an answer for all questions');
                    return false;
                }
            }
            
            return true;
        }
        
        function calculateScore(formData) {
            let score = 0;
            
            // ØªÙ‚ÙŠÙŠÙ… Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ…
            const sleepHours = parseInt(formData.get('sleep_hours'));
            if (sleepHours === 7) score += 25;
            else if (sleepHours === 5 || sleepHours === 9) score += 15;
            else score += 5;
            
            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù†ØªØ¸Ø§Ù… Ø§Ù„Ù†ÙˆÙ…
            const weekendSchedule = formData.get('weekend_schedule');
            if (weekendSchedule === 'yes') score += 20;
            else if (weekendSchedule === 'sometimes') score += 10;
            
            // ØªÙ‚ÙŠÙŠÙ… ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…
            const sleepLatency = parseInt(formData.get('sleep_latency'));
            if (sleepLatency === 5) score += 15;
            else if (sleepLatency === 15) score += 10;
            else if (sleepLatency === 45) score += 5;
            
            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸ Ø§Ù„Ù„ÙŠÙ„ÙŠ
            const awakenings = parseInt(formData.get('night_awakenings'));
            if (awakenings === 0) score += 15;
            else if (awakenings === 1) score += 10;
            else if (awakenings === 3) score += 5;
            
            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø´Ø¹ÙˆØ± Ø§Ù„ØµØ¨Ø§Ø­ÙŠ
            const morningFeeling = formData.get('morning_feeling');
            if (morningFeeling === 'refreshed') score += 15;
            else if (morningFeeling === 'okay') score += 8;
            
            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ†
            const caffeine = formData.get('caffeine');
            if (caffeine === 'none' || caffeine === 'morning') score += 10;
            else if (caffeine === 'afternoon') score += 5;
            
            return Math.min(score, 100);
        }
        
        function generateRecommendations(formData, score) {
            const recommendations = [];
            
            if (parseInt(formData.get('sleep_hours')) < 7) {
                recommendations.push(lang === 'ar' ? 'Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆÙ… 7-9 Ø³Ø§Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹' : 'Aim for 7-9 hours of sleep daily');
            }
            
            if (formData.get('weekend_schedule') !== 'yes') {
                recommendations.push(lang === 'ar' ? 'Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù†ÙˆÙ… ÙÙŠ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹' : 'Maintain consistent sleep schedule on weekends');
            }
            
            if (formData.get('caffeine') === 'evening' || formData.get('caffeine') === 'night') {
                recommendations.push(lang === 'ar' ? 'ØªØ¬Ù†Ø¨ Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 2 Ø¸Ù‡Ø±Ø§Ù‹' : 'Avoid caffeine after 2 PM');
            }
            
            if (formData.get('screen_time') === 'immediately') {
                recommendations.push(lang === 'ar' ? 'Ø£ØºÙ„Ù‚ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø¨Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©' : 'Turn off screens 1 hour before bed');
            }
            
            if (formData.get('sleep_environment') === 'poor') {
                recommendations.push(lang === 'ar' ? 'Ø­Ø³Ù‘Ù† Ø¨ÙŠØ¦Ø© Ø§Ù„Ù†ÙˆÙ…: Ø§Ø¬Ø¹Ù„Ù‡Ø§ Ù…Ø¸Ù„Ù…Ø© ÙˆÙ‡Ø§Ø¯Ø¦Ø© ÙˆØ¨Ø§Ø±Ø¯Ø©' : 'Improve sleep environment: make it dark, quiet, and cool');
            }
            
            return recommendations;
        }
        
        document.getElementById('sleep-assessment-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateCurrentSection()) return;
            
            const formData = new FormData(this);
            const score = calculateScore(formData);
            const recommendations = generateRecommendations(formData, score);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            document.getElementById('score-value').textContent = score;
            
            const recList = document.getElementById('recommendations-list');
            recList.innerHTML = '';
            recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recList.appendChild(li);
            });
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            document.querySelector('form').style.display = 'none';
            document.getElementById('results-container').style.display = 'block';
            
            // Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const assessmentData = {
                score: score,
                recommendations: recommendations,
                date: new Date().toISOString(),
                answers: Object.fromEntries(formData)
            };
            
            localStorage.setItem('sleepAssessment', JSON.stringify(assessmentData));
        });
        
        function saveToHealthState() {
            const assessmentData = JSON.parse(localStorage.getItem('sleepAssessment'));
            
            // Ø­ÙØ¸ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ©
            const healthData = JSON.parse(localStorage.getItem('healthStateData') || '{}');
            healthData.sleepAssessment = assessmentData;
            localStorage.setItem('healthStateData', JSON.stringify(healthData));
            
            alert(lang === 'ar' ? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ ØµÙØ­Ø© Ø­Ø§Ù„ØªÙŠ Ø§Ù„ØµØ­ÙŠØ©' : 'Results saved to Health State page');
        }
        
        function retakeAssessment() {
            location.reload();
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
        });
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('../sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>